{"version":3,"sources":["../../src/useTable/index.ts","../../src/utils/useIsFirstRender/index.ts"],"sourcesContent":["import { useEffect } from \"react\";\nimport {\n    BaseRecord,\n    CrudOperators,\n    HttpError,\n    LogicalFilter,\n    useTable as useTableCore,\n    useTableProps as useTablePropsCore,\n    useTableReturnType as useTableReturnTypeCore,\n} from \"@refinedev/core\";\nimport {\n    useReactTable,\n    TableOptions,\n    Table,\n    getCoreRowModel,\n    ColumnFilter,\n    getSortedRowModel,\n    getFilteredRowModel,\n} from \"@tanstack/react-table\";\n\nimport { useIsFirstRender } from \"../utils\";\n\nexport type UseTableReturnType<\n    TData extends BaseRecord = BaseRecord,\n    TError extends HttpError = HttpError,\n> = Table<TData> & {\n    refineCore: useTableReturnTypeCore<TData, TError>;\n};\n\nexport type UseTableProps<\n    TQueryFnData extends BaseRecord = BaseRecord,\n    TError extends HttpError = HttpError,\n    TData extends BaseRecord = TQueryFnData,\n> = {\n    /**\n     * Configuration object for the core of the [useTable](/docs/api-reference/core/hooks/useTable/)\n     * @type [`useTablePropsCore<TQueryFnData, TError>`](/docs/api-reference/core/hooks/useTable/#properties)\n     */\n    refineCoreProps?: useTablePropsCore<TQueryFnData, TError, TData>;\n} & Pick<TableOptions<TData>, \"columns\"> &\n    Partial<Omit<TableOptions<TData>, \"columns\">>;\n\nexport function useTable<\n    TQueryFnData extends BaseRecord = BaseRecord,\n    TError extends HttpError = HttpError,\n    TData extends BaseRecord = TQueryFnData,\n>({\n    refineCoreProps: { hasPagination = true, ...refineCoreProps } = {},\n    initialState: reactTableInitialState = {},\n    ...rest\n}: UseTableProps<TQueryFnData, TError, TData>): UseTableReturnType<\n    TData,\n    TError\n> {\n    const isFirstRender = useIsFirstRender();\n\n    const useTableResult = useTableCore<TQueryFnData, TError, TData>({\n        ...refineCoreProps,\n        hasPagination,\n    });\n\n    const isServerSideFilteringEnabled =\n        (refineCoreProps.filters?.mode || \"server\") === \"server\";\n    const isServerSideSortingEnabled =\n        (refineCoreProps.sorters?.mode || \"server\") === \"server\";\n    const hasPaginationString = hasPagination === false ? \"off\" : \"server\";\n    const isPaginationEnabled =\n        (refineCoreProps.pagination?.mode ?? hasPaginationString) !== \"off\";\n\n    const {\n        tableQueryResult: { data },\n        current,\n        setCurrent,\n        pageSize: pageSizeCore,\n        setPageSize: setPageSizeCore,\n        sorters,\n        setSorters,\n        filters: filtersCore,\n        setFilters,\n        pageCount,\n    } = useTableResult;\n\n    const logicalFilters: LogicalFilter[] = [];\n    filtersCore.forEach((filter) => {\n        if (\n            filter.operator !== \"or\" &&\n            filter.operator !== \"and\" &&\n            \"field\" in filter\n        ) {\n            logicalFilters.push(filter);\n        }\n    });\n\n    const reactTableResult = useReactTable<TData>({\n        data: data?.data ?? [],\n        getCoreRowModel: getCoreRowModel(),\n        getSortedRowModel: isServerSideSortingEnabled\n            ? undefined\n            : getSortedRowModel(),\n        getFilteredRowModel: isServerSideFilteringEnabled\n            ? undefined\n            : getFilteredRowModel(),\n        initialState: {\n            pagination: {\n                pageIndex: current - 1,\n                pageSize: pageSizeCore,\n            },\n            sorting: sorters.map((sorting) => ({\n                id: sorting.field,\n                desc: sorting.order === \"desc\",\n            })),\n            columnFilters: logicalFilters.map((filter) => ({\n                id: filter.field,\n                operator: filter.operator as Exclude<\n                    CrudOperators,\n                    \"or\" | \"and\"\n                >,\n                value: filter.value,\n            })),\n            ...reactTableInitialState,\n        },\n        pageCount,\n        manualPagination: true,\n        manualSorting: isServerSideSortingEnabled,\n        manualFiltering: isServerSideFilteringEnabled,\n        ...rest,\n    });\n\n    const { state, columns } = reactTableResult.options;\n    const { pagination, sorting, columnFilters } = state;\n\n    const { pageIndex, pageSize } = pagination ?? {};\n\n    useEffect(() => {\n        if (pageIndex !== undefined) {\n            setCurrent(pageIndex + 1);\n        }\n    }, [pageIndex]);\n\n    useEffect(() => {\n        if (pageSize !== undefined) {\n            setPageSizeCore(pageSize);\n        }\n    }, [pageSize]);\n\n    useEffect(() => {\n        if (sorting !== undefined) {\n            setSorters(\n                sorting?.map((sorting) => ({\n                    field: sorting.id,\n                    order: sorting.desc ? \"desc\" : \"asc\",\n                })),\n            );\n\n            if (sorting.length > 0 && isPaginationEnabled && !isFirstRender) {\n                setCurrent(1);\n            }\n        }\n    }, [sorting]);\n\n    useEffect(() => {\n        const crudFilters: LogicalFilter[] = [];\n\n        columnFilters?.map((filter) => {\n            const operator =\n                (\n                    filter as ColumnFilter & {\n                        operator?: Exclude<CrudOperators, \"or\" | \"and\">;\n                    }\n                ).operator ??\n                ((columns.find((c) => c.id === filter.id) as any)?.meta\n                    ?.filterOperator as Exclude<CrudOperators, \"or\" | \"and\">);\n\n            crudFilters.push({\n                field: filter.id,\n                operator:\n                    operator ?? (Array.isArray(filter.value) ? \"in\" : \"eq\"),\n                value: filter.value,\n            });\n        });\n\n        const filteredArray = logicalFilters.filter(\n            (value) =>\n                !crudFilters.some(\n                    (b) =>\n                        value.field === b.field &&\n                        value.operator === b.operator,\n                ),\n        );\n\n        filteredArray?.map((filter) => {\n            crudFilters.push({\n                field: filter.field,\n                operator: filter.operator,\n                value: undefined,\n            });\n        });\n\n        setFilters(crudFilters);\n\n        if (crudFilters.length > 0 && isPaginationEnabled && !isFirstRender) {\n            setCurrent(1);\n        }\n    }, [columnFilters]);\n\n    return {\n        ...reactTableResult,\n        refineCore: useTableResult,\n    };\n}\n","import { useEffect, useRef } from \"react\";\n\nexport const useIsFirstRender = () => {\n    const firstRender = useRef(true);\n\n    useEffect(() => {\n        firstRender.current = false;\n    }, []);\n\n    return firstRender.current;\n};\n"],"mappings":"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","names":["useEffect","useTableCore","useReactTable","getCoreRowModel","getSortedRowModel","getFilteredRowModel","useEffect","useRef","useIsFirstRender","__name","firstRender","useRef","useEffect","useTable","hasPagination","refineCoreProps","reactTableInitialState","rest","_a","_b","_c","isFirstRender","useIsFirstRender","useTableResult","useTableCore","isServerSideFilteringEnabled","isServerSideSortingEnabled","hasPaginationString","isPaginationEnabled","data","current","setCurrent","pageSizeCore","setPageSizeCore","sorters","setSorters","filtersCore","setFilters","pageCount","logicalFilters","filter","reactTableResult","useReactTable","getCoreRowModel","getSortedRowModel","getFilteredRowModel","sorting","state","columns","pagination","columnFilters","pageIndex","pageSize","useEffect","crudFilters","operator","c","filteredArray","value","b","__name"]}